# Docker Compose for benchmark comparison
#
# Ports:
# - tileserver-rs: http://127.0.0.1:8000 (run natively, not in Docker)
# - martin:        http://127.0.0.1:8001
# - tileserver-gl: http://127.0.0.1:8002
#
# Run: docker compose -f benchmarks/docker-compose.yml up -d

services:
  # Martin - Rust-based tile server (latest v1.1.0+)
  # https://github.com/maplibre/martin
  # Supports both PMTiles and MBTiles
  martin:
    image: ghcr.io/maplibre/martin:latest
    ports:
      - "8001:3000"
    volumes:
      - ../data/tiles:/data:ro
    command: ["/data/zurich_switzerland.mbtiles", "/data/protomaps-sample.pmtiles"]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/catalog"]
      interval: 5s
      timeout: 3s
      retries: 3

  # tileserver-gl - Node.js-based tile server with raster rendering
  # https://github.com/maptiler/tileserver-gl
  # Note: tileserver-gl only supports MBTiles, not PMTiles
  tileserver-gl:
    image: maptiler/tileserver-gl:latest
    ports:
      - "8002:8080"
    volumes:
      - ../data/tiles:/data:ro
    command: ["-p", "8080", "--mbtiles", "/data/zurich_switzerland.mbtiles"]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 5s
      timeout: 3s
      retries: 3
