# Tileserver-RS Configuration Example
# Copy this file to config.toml and customize for your setup

# ============================================================================
# ROOT-LEVEL CONFIGURATION
# These must come BEFORE any [section] headers due to TOML parsing rules
# ============================================================================

# Path to fonts directory (for serving PBF glyph files)
# The directory structure should be:
#   fonts/
#   ├── Noto Sans Regular/
#   │   ├── 0-255.pbf
#   │   ├── 256-511.pbf
#   │   └── ...
#   └── Open Sans Bold/
#       └── ...
# fonts = "/data/fonts"

# Path to static files directory (for /files/{filename} endpoint)
# Serves arbitrary static files like GeoJSON overlays, custom icons, etc.
# files = "/data/files"

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
[server]
# Host to bind to (use 0.0.0.0 to listen on all interfaces)
host = "0.0.0.0"
# Port to listen on
port = 8080
# Allowed CORS origins (use ["*"] for all origins)
cors_origins = ["*"]

# ============================================================================
# OPENTELEMETRY CONFIGURATION
# ============================================================================
[telemetry]
# Enable OpenTelemetry tracing (default: false)
enabled = false
# OTLP endpoint for exporting traces (gRPC)
endpoint = "http://localhost:4317"
# Service name for traces
service_name = "tileserver-rs"
# Sampling rate (0.0 to 1.0, where 1.0 = 100% of traces)
sample_rate = 1.0

# ============================================================================
# TILE SOURCES
# PMTiles and MBTiles files - add multiple sources, each with a unique ID
# ============================================================================

# Example: Local PMTiles file
# [[sources]]
# id = "osm"
# type = "pmtiles"
# path = "/data/osm.pmtiles"
# name = "OpenStreetMap"
# attribution = "<a href=\"https://www.openstreetmap.org/copyright\">© OpenStreetMap</a>"

# Example: Remote PMTiles file (requires http feature)
# [[sources]]
# id = "protomaps"
# type = "pmtiles"
# path = "https://example.com/tiles.pmtiles"
# name = "Protomaps Tiles"

# Example: Local MBTiles file
# [[sources]]
# id = "terrain"
# type = "mbtiles"
# path = "/data/terrain.mbtiles"
# name = "Terrain RGB"

# ============================================================================
# RASTER SOURCES (requires --features raster and GDAL system library)
# Supports COG (Cloud Optimized GeoTIFF) and VRT (Virtual Raster) files
# ============================================================================

# Example: Cloud Optimized GeoTIFF with continuous colormap (elevation gradient)
# [[sources]]
# id = "elevation"
# type = "cog"
# path = "/data/dem.tif"
# name = "Digital Elevation Model"
# attribution = "© USGS"
# resampling = "cubic"
# [sources.colormap]
# map_type = "continuous"
# nodata_color = "#00000000"
# entries = [
#   { value = 0.0, color = "#0000ff" },
#   { value = 500.0, color = "#00ff00" },
#   { value = 1000.0, color = "#ffff00" },
#   { value = 2000.0, color = "#ff0000" },
#   { value = 4000.0, color = "#ffffff" },
# ]

# Example: Land cover with discrete colormap (categorical data)
# [[sources]]
# id = "landcover"
# type = "cog"
# path = "/data/nlcd.tif"
# name = "Land Cover Classification"
# resampling = "nearest"
# [sources.colormap]
# map_type = "discrete"
# nodata_color = "#00000000"
# entries = [
#   { value = 11.0, color = "#466b9f" },
#   { value = 21.0, color = "#d99282" },
#   { value = 22.0, color = "#eb0000" },
#   { value = 23.0, color = "#ab0000" },
#   { value = 41.0, color = "#68ab5f" },
#   { value = 42.0, color = "#1c5f2c" },
#   { value = 43.0, color = "#b5c58f" },
#   { value = 52.0, color = "#ccb879" },
#   { value = 71.0, color = "#dfdfc2" },
#   { value = 81.0, color = "#dcd939" },
#   { value = 82.0, color = "#ab6c28" },
#   { value = 90.0, color = "#b8d9eb" },
#   { value = 95.0, color = "#6c9fb8" },
# ]

# Example: VRT (Virtual Raster) for mosaics
# [[sources]]
# id = "imagery"
# type = "vrt"
# path = "/data/mosaic.vrt"
# name = "Satellite Imagery"
# resampling = "lanczos"

# Query parameter override:
# Tiles served from raster sources support ?resampling=<method> to override default
# Example: /data/elevation/14/8192/5461.png?resampling=nearest

# ============================================================================
# GLOBAL RASTER SETTINGS (optional, requires --features raster)
# ============================================================================
# [raster]
# default_resampling = "bilinear"  # Default for all raster sources
# tile_size = 256                  # Tile size in pixels (256 or 512)

# ============================================================================
# POSTGRESQL FUNCTION SOURCES (requires --features postgres)
# ============================================================================
# PostgreSQL function sources allow serving vector tiles directly from
# PostGIS functions, similar to martin's function source feature.
#
# Your function must have one of these signatures:
#
# Simple function (z, x, y):
#   CREATE FUNCTION my_tiles(z integer, x integer, y integer)
#       RETURNS bytea AS $$ ... $$ LANGUAGE plpgsql;
#
# Function with query parameters (z, x, y, query):
#   CREATE FUNCTION my_tiles(z integer, x integer, y integer, query json)
#       RETURNS bytea AS $$ ... $$ LANGUAGE plpgsql;
#
# Example tile function:
#   CREATE OR REPLACE FUNCTION get_building_tiles(z integer, x integer, y integer)
#       RETURNS bytea AS $$
#   DECLARE
#       mvt bytea;
#   BEGIN
#       SELECT INTO mvt ST_AsMVT(tile, 'buildings', 4096, 'geom') FROM (
#           SELECT
#               ST_AsMVTGeom(geom, ST_TileEnvelope(z, x, y), 4096, 64, true) AS geom,
#               name, height
#           FROM buildings
#           WHERE geom && ST_TileEnvelope(z, x, y)
#       ) AS tile WHERE geom IS NOT NULL;
#       RETURN mvt;
#   END
#   $$ LANGUAGE plpgsql IMMUTABLE STRICT PARALLEL SAFE;
#
# [postgres]
# # PostgreSQL connection string
# connection_string = "postgresql://user:password@localhost:5432/mydb"
# # Maximum connections in pool (default: 20)
# pool_size = 20
# # Connection pool timeouts (milliseconds)
# pool_wait_timeout_ms = 30000    # Timeout waiting for connection from pool
# pool_create_timeout_ms = 10000  # Timeout creating new connection
# pool_recycle_timeout_ms = 5000  # Timeout recycling connection
# # SSL certificate paths (optional)
# # ssl_cert = "/path/to/client.crt"
# # ssl_key = "/path/to/client.key"
# # ssl_root_cert = "/path/to/ca.crt"
#
# # Tile cache configuration (optional, disabled if omitted)
# # Caches rendered tiles in memory using LRU with byte-size weighting
# [postgres.cache]
# size_mb = 256        # Maximum cache size in megabytes
# ttl_seconds = 3600   # Cache entry time-to-live (1 hour)
#
# # Function sources
# [[postgres.functions]]
# id = "buildings"
# schema = "public"
# function = "get_building_tiles"
# name = "Buildings"
# attribution = "© My Company"
# minzoom = 10
# maxzoom = 18
# bounds = [-122.5, 37.5, -122.0, 38.0]
#
# [[postgres.functions]]
# id = "roads"
# function = "get_road_tiles"  # schema defaults to "public"
# maxzoom = 14
#
# # Table sources (auto-discover geometry columns, generate optimized SQL)
# [[postgres.tables]]
# id = "buildings"
# table = "buildings"
# geometry_column = "geom"   # Optional: auto-detected from geometry_columns
# id_column = "id"           # Optional: feature ID column
# properties = ["name", "height"]  # Optional: auto-detected if omitted
# minzoom = 0
# maxzoom = 18
# extent = 4096    # MVT tile extent (default: 4096)
# buffer = 64      # Tile buffer in pixels (default: 64)

# ============================================================================
# MAP STYLES
# ============================================================================
# Map styles
# Sprites should be placed alongside style.json:
#   styles/my-style/
#   ├── style.json
#   ├── sprite.json
#   ├── sprite.png
#   ├── sprite@2x.json
#   └── sprite@2x.png
# [[styles]]
# id = "osm-bright"
# path = "/data/styles/osm-bright/style.json"
# name = "OSM Bright"
